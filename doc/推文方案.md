## 项目方案：朋友圈动态系统
### 一、功能概述
目标是搭建一套支持**动态发布/推送、分层数据存储、广场随机拉取、详情高效访问**的朋友圈系统，适配C端用户“刷广场、看动态、查详情”的核心场景，兼顾性能与可靠性。


### 二、核心功能模块
1. **用户侧功能**
   - 动态发布：支持文本+媒体（图片/视频）发布
   - 动态消费：广场随机/条件拉取缩略动态、点击查看完整详情
   - 推送触达：关注用户的新动态自动推送至客户端

2. **服务侧能力**
   - 数据分层存储：数据库存全量数据、Redis缓存高频访问的缩略/详情数据
   - 异步推送：基于Kafka实现动态推送的异步解耦
   - 去重&状态管理：通过Redis管控推送任务的去重、状态、过期逻辑


### 三、技术架构分层
| 层级          | 核心组件&职责                                                                 |
|---------------|------------------------------------------------------------------------------|
| 客户端层      | 拉取广场动态、访问详情数据、接收推送消息                                     |
| 服务层        | 接口层（鉴权/媒体处理）、业务逻辑层（数据体拆分、拉取）|
| 数据存储层    | 数据库（落库全量动态，用户信箱）、日志库（记录推送/过期异常）|
| 缓存&消息层   | Redis（①推送任务+状态；②数据缓存）、Kafka（异步推送队列）|


### 四、核心业务流程
#### 1. 动态发布&推送流程
```
客户端 → 接口层（鉴权+媒体处理）→ 资源服务器（存储媒体）
→ 生成“完整数据+缩略数据” → 数据库落库
→ Redis标记“业务ID+推送状态” → 封装消息入Kafka队列
→ Kafka推送至客户端 → 推送成功/失败后更新Redis状态
→ 失败任务查Redis过期：未过期重试/过期记日志库
```

#### 2. 动态拉取流程（对应第二张图）
```
// 关注拉取
客户端 → 服务器 → 数据库查询receive动态 → 从Redis缓存中拉取-缩略数据体 -> Redis无数据则穿透至数据库拉取 -> 返回客户端

// 广场拉取
客户端 → 服务器 → 从Redis随机/条件拉取“缩略数据体” → 返回客户端

// 详情访问
客户端 → 直接访问Redis（详情缓存）→ Redis无数据则穿透至数据库拉取 → 返回完整数据
```