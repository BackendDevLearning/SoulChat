# 数据传输格式

## 1. 设计

1. 前端输入 JSON 或文本；
2. 前端 SDK（前端逻辑）负责把 JSON 转成 Protobuf 二进制；
3. WebSocket 服务端收到二进制后，用 proto.Unmarshal() 还原；
4. 服务器广播给其他客户端时，再发 Protobuf 二进制；
5. 客户端收到后再转回 JSON，用于展示。

**本质上这种设计包含三个层次：**

| 层级   | 参与者       | 数据格式               | 作用         |
| ------ | ------------ | ---------------------- | ------------ |
| 用户层 | 用户/界面    | 文本（字符串）         | 产生原始内容 |
| 应用层 | 前端 SDK     | JSON → Protobuf struct | 封装消息结构 |
| 传输层 | 网络（后端） | 二进制流               | 高效传输     |

## 2. 优点

| 优点       | 说明                                 |
| ---------- | ------------------------------------ |
| 高性能     | 网络传输时体积小、速度快             |
| 强类型     | 字段固定、版本兼容                   |
| 用户体验好 | 用户只接触 JSON / 文本，不接触字节流 |
| 调试方便   | 可以在 SDK 层加日志打印 JSON         |

